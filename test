@app.post("/chat")
async def chat_endpoint(request: Request, authorization: str | None = Header(None)):
    # Skip token verification for now
    if not authorization or not authorization.startswith("Bearer "):
        return JSONResponse(status_code=401, content={"detail": "Access token required"})

    # Parse the request data
    data = await request.json()
    stream = data.get("stream", False)  # Check if streaming is requested

    # Run the chat logic
    result = await run_chat(request)

    # Handle streaming response
    if stream:
        return StreamingResponse(result, media_type="text/plain")
    else:
        return JSONResponse(result)
